<div [class]="styles.authWrapper">
  <!-- Dynamic Background Effects -->
  <div class="auth-ambient"></div>
  <div class="auth-mesh"></div>

  <div class="auth-container p-4 fadein animation-duration-1000">
    <p-toast></p-toast>
    <div [class]="styles.authCard">
      <div class="text-center mb-6">
        <div [class]="styles.logoBox">
          <img src="logo.png" alt="NEX Logo" class="h-4rem" />
        </div>
        <h2 class="text-4xl font-black mb-1 text-white">
          GENESIS<span [class]="theme.ui.gradientText">HUB</span>
        </h2>
        <p [class]="theme.typography.label">Register Your NEX Identity</p>
      </div>

      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="flex flex-column gap-4">
        <div class="formgrid grid grid-nogutter gap-3">
          <div class="col">
            <label [class]="styles.label">First Name</label>
            <input
              pInputText
              formControlName="firstName"
              class="mbux-input"
              placeholder="First Name"
            />
             @if ((submitted || registerForm.get('firstName')?.touched) && registerForm.get('firstName')?.invalid) {
            <div [class]="styles.validationWarning" [class.innovative]="registerForm.get('firstName')?.hasError('pattern')" class="mt-2">
              <i class="pi pi-info-circle mr-2"></i>
              {{ registerForm.get('firstName')?.hasError('required') ? 'Required.' : 'Letters only.' }}
            </div>
            }
          </div>
          <div class="col">
            <label [class]="styles.label">Last Name</label>
            <input pInputText formControlName="lastName" class="mbux-input" placeholder="Last Name" />
             @if ((submitted || registerForm.get('lastName')?.touched) && registerForm.get('lastName')?.invalid) {
            <div [class]="styles.validationWarning" [class.innovative]="registerForm.get('lastName')?.hasError('pattern')" class="mt-2">
              <i class="pi pi-info-circle mr-2"></i>
              {{ registerForm.get('lastName')?.hasError('required') ? 'Required.' : 'Letters only.' }}
            </div>
            }
          </div>
        </div>

        <div class="form-group">
          <label [class]="styles.label">Username</label>
          <input
            pInputText
            formControlName="username"
            class="mbux-input"
            placeholder="Username"
          />
          @if ((submitted || registerForm.get('username')?.touched) && registerForm.get('username')?.invalid) {
          <div [class]="styles.validationWarning" [class.innovative]="registerForm.get('username')?.errors && !registerForm.get('username')?.hasError('required')" class="mt-2">
            <i class="pi pi-info-circle mr-2"></i>
            @if (registerForm.get('username')?.hasError('required')) { Username required. }
            @if (registerForm.get('username')?.hasError('pattern')) { Alphanumeric only. }
            @if (registerForm.get('username')?.hasError('notUnique')) { Username taken. }
          </div>
          }
        </div>

        <div class="form-group">
          <label [class]="styles.label">Email</label>
          <input
            pInputText
            formControlName="email"
            class="mbux-input"
            placeholder="name@email.com"
          />
          @if ((submitted || registerForm.get('email')?.touched) &&
          registerForm.get('email')?.invalid) {
          <div [class]="styles.validationWarning" class="mt-2">
            <i class="pi pi-info-circle mr-2"></i>
            Valid email required.
          </div>
          }
        </div>

        <div class="form-group">
          <label [class]="styles.label">Password</label>
          <p-password
            formControlName="password"
            [toggleMask]="true"
            styleClass="w-full"
            inputStyleClass="mbux-input"
            placeholder="••••••••"
          ></p-password>
          @if ((submitted || registerForm.get('password')?.touched) &&
          registerForm.get('password')?.invalid) {
          <div [class]="styles.validationWarning" [class.innovative]="registerForm.get('password')?.invalid && !registerForm.get('password')?.hasError('required')" class="mt-2">
            <i class="pi pi-shield mr-2"></i>
            <div class="flex flex-column">
              @if (registerForm.get('password')?.hasError('required')) { <span>Password required.</span> }
              @if (registerForm.get('password')?.hasError('minlength')) { <span>Minimum 6 characters.</span> }
              @if (registerForm.get('password')?.hasError('uppercase')) { <span>Integration: Uppercase character required.</span> }
              @if (registerForm.get('password')?.hasError('number')) { <span>Segment: Numerical character required.</span> }
              @if (registerForm.get('password')?.hasError('special')) { <span>Entropy: Symbolic character required.</span> }
            </div>
          </div>
          }
        </div>

        <div class="form-group">
          <label [class]="styles.label">Confirm Password</label>
          <p-password
            formControlName="confirmPassword"
            [toggleMask]="true"
            [feedback]="false"
            styleClass="w-full"
            inputStyleClass="mbux-input"
            placeholder="••••••••"
          ></p-password>
          @if ((submitted || registerForm.hasError('mismatch')) && registerForm.get('confirmPassword')?.touched) {
             @if (registerForm.hasError('mismatch')) {
              <div [class]="styles.validationWarning" class="innovative mt-2">
                <i class="pi pi-exclamation-triangle mr-2"></i>
                Passwords do not match.
              </div>
             }
             @if (registerForm.get('confirmPassword')?.hasError('required') && !registerForm.hasError('mismatch')) {
               <div [class]="styles.validationWarning" class="mt-2">
                <i class="pi pi-exclamation-circle mr-2"></i>
                Confirmation required.
              </div>
             }
          }
        </div>

        <p-button
          label="Create Account"
          type="submit"
          [loading]="loading"
          styleClass="p-button-primary p-button-lg w-full py-4 mt-2"
        ></p-button>

        <div class="text-center mt-3">
          <span class="text-secondary text-sm">Already have an account? </span>
          <a
            routerLink="/auth/login"
            class="text-primary font-bold no-underline hover:text-white transition-all cursor-pointer"
            >Sign In</a
          >
        </div>
      </form>
    </div>
  </div>
</div>
